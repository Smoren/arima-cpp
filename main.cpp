#include <chrono>
#include <iostream>
#include "src/arima.h"
#include "src/utils.h"

void single_example() {
    Eigen::ArrayXd data(100);

    data << 0.49671415, 1.35678402, 2.9928317, 5.48437031,
            6.18919829, 6.8551333, 9.28651546, 10.84970233,
            11.11161198, 12.31388021, 12.43190327, 12.46353727,
            13.1138168, 11.51572755, 10.00972516, 9.5678902,
            8.57584525, 8.81100465, 7.72480878, 6.03702965,
            7.13265181, 6.44599491, 5.96639348, 3.91373338,
            2.66693034, 2.00794256, 0.02724126, -0.47827563,
            -2.00283162, -3.25191358, -4.83491341, -3.97802868,
            -4.99107396, -7.0425004, -7.19790957, -9.37117447,
            -10.07968303, -12.91251013, -15.06091368, -15.62313513,
            -15.57503191, -16.01840979, -16.66704468, -17.41405002,
            -19.24693338, -20.22605803, -20.84830566, -19.85350597,
            -19.4723012, -21.09822139, -20.53885404, -20.5928404,
            -20.84616213, -19.72261371, -18.09658464, -16.4930629,
            -16.58954355, -16.09294497, -14.90084791, -13.01804763,
            -12.5526102, -11.76573924, -11.8813432, -12.07851679,
            -10.26863793, -7.92669006, -7.03448643, -5.09786796,
            -3.84359763, -3.64545326, -2.49858931, -0.24072833,
            0.37043387, 2.5027651, 0.36573474, 1.58055606,
            1.96680008, 1.87027835, 2.06579024, 0.08220129,
            -0.23330155, -0.07087334, 1.11542816, 0.21157072,
            -1.07265214, -2.13552714, -1.86102517, -2.24655274,
            -3.55683331, -3.88252925, -4.67447541, -4.63603165,
            -6.30016922, -7.61218628, -9.00108441, -11.46386482,
            -12.15950115, -12.87278433, -13.8148559, -14.96001068;

    auto model = ARIMAModel(25, 1, 1);
    model.fit(data);
    const auto predictions = model.predict(100);

    std::cout << "Predictions: " << std::endl;
    std::cout << predictions.head(3) << std::endl;
}

void resample_time_series_example() {
    Eigen::ArrayXXd data(100, 4);

    data << -2.50919762e-02, -2.33484019e-01, 5.00102644e+00, 4.07563500e-02,
            1.91152962e-01, 1.85751777e+00, 5.20223637e+00, -2.54222538e-02,
            2.48418990e-01, 2.43467801e+00, 5.08688762e+00, 2.62969729e-02,
            3.22762000e-01, 2.75031777e+00, 5.52622449e+00, 1.29292241e-02,
            3.35244132e-01, 2.82450915e+00, 5.63119322e+00, 4.79526725e-02,
            4.36249409e-01, 3.83136569e+00, 5.26982572e+00, 2.97266186e-01,
            5.17677328e-01, 4.85014467e+00, 4.86878775e+00, 7.30983953e-01,
            7.80305936e-01, 6.83282802e+00, 4.17391933e+00, 9.94752160e-01,
            8.28303810e-01, 7.00401643e+00, 3.95636735e+00, 1.53717361e+00,
            9.14217909e-01, 7.45666342e+00, 3.77058637e+00, 1.37131682e+00,
            9.50705425e-01, 7.85714587e+00, 3.71872838e+00, 1.44302943e+00,
            1.20509308e+00, 9.12336481e+00, 2.58664751e+00, 2.38330567e+00,
            1.25559914e+00, 9.18604037e+00, 2.17927791e+00, 2.62592382e+00,
            1.27860974e+00, 9.35750444e+00, 1.76652281e+00, 2.58885444e+00,
            1.35050641e+00, 9.55909808e+00, 1.32954843e+00, 2.83076702e+00,
            1.45183242e+00, 9.92380704e+00, 1.00168299e+00, 3.15809155e+00,
            1.57701006e+00, 9.85388202e+00, 4.20015725e-01, 3.60893366e+00,
            1.72212300e+00, 9.67426216e+00, -5.51812441e-01, 4.49697443e+00,
            1.80457082e+00, 9.43811062e+00, -9.21682305e-01, 5.00452984e+00,
            1.87743775e+00, 8.95094562e+00, -1.19565605e+00, 5.26839289e+00,
            2.04257260e+00, 8.38426640e+00, -2.13548156e+00, 6.41930835e+00,
            2.04911089e+00, 8.40657274e+00, -2.13380809e+00, 6.52089720e+00,
            2.18065115e+00, 7.72718757e+00, -2.68449091e+00, 7.51804562e+00,
            2.29650469e+00, 6.96325332e+00, -3.36767010e+00, 8.42201292e+00,
            2.41545642e+00, 5.83973908e+00, -3.71651250e+00, 9.09695780e+00,
            2.56619738e+00, 4.55741975e+00, -4.06051466e+00, 1.01113305e+01,
            2.58228772e+00, 4.35318401e+00, -3.88713861e+00, 1.03850505e+01,
            2.73011961e+00, 2.88635532e+00, -4.02092093e+00, 1.16851394e+01,
            2.83858301e+00, 1.83844053e+00, -4.48600527e+00, 1.25869597e+01,
            2.84676574e+00, 1.84105220e+00, -4.68561877e+00, 1.26802077e+01,
            3.05181200e+00, 2.09147910e-01, -4.77821157e+00, 1.47499626e+01,
            3.06541796e+00, 1.08473101e-01, -4.68109281e+00, 1.47564945e+01,
            3.14533355e+00, -6.38436212e-01, -4.59254774e+00, 1.56104178e+01,
            3.42311044e+00, -3.39405658e+00, -3.62521084e+00, 1.83068222e+01,
            3.52746984e+00, -4.76339043e+00, -3.34020153e+00, 1.93513236e+01,
            3.59703300e+00, -5.40355174e+00, -2.97108231e+00, 2.03144834e+01,
            3.59728639e+00, -5.39378113e+00, -2.77972455e+00, 2.04823010e+01,
            3.65690816e+00, -5.42837314e+00, -2.51035300e+00, 2.12937648e+01,
            3.87523044e+00, -7.23451130e+00, -1.93643817e+00, 2.40215112e+01,
            3.92742444e+00, -7.55257510e+00, -1.60492709e+00, 2.46365895e+01,
            3.96481169e+00, -7.81876545e+00, -1.62481211e+00, 2.52155836e+01,
            4.14044952e+00, -9.12764774e+00, -9.79174681e-01, 2.72889161e+01,
            4.14930195e+00, -8.94666805e+00, -1.03892391e+00, 2.74638259e+01,
            4.39620044e+00, -9.84444336e+00, 9.17151982e-02, 3.06026048e+01,
            4.42529842e+00, -9.77267999e+00, 6.93563156e-01, 3.10070357e+01,
            4.57795900e+00, -1.02736186e+01, 1.06579816e+00, 3.31877309e+01,
            4.60880686e+00, -1.00296825e+01, 1.35619251e+00, 3.34491748e+01,
            4.75148835e+00, -1.03560082e+01, 1.74608134e+00, 3.58709636e+01,
            4.85782690e+00, -1.01407050e+01, 2.18087664e+00, 3.72025211e+01,
            4.88646584e+00, -9.65705694e+00, 2.54003316e+00, 3.73782827e+01,
            5.14442198e+00, -9.08745951e+00, 3.78048336e+00, 4.14911984e+01,
            5.20654172e+00, -8.92326401e+00, 3.84277466e+00, 4.26140297e+01,
            5.34042504e+00, -8.19145496e+00, 4.26606787e+00, 4.48569482e+01,
            5.43250082e+00, -7.71763992e+00, 4.76154766e+00, 4.64705056e+01,
            5.47412545e+00, -7.74683911e+00, 4.76902588e+00, 4.71490327e+01,
            5.57426416e+00, -7.00689258e+00, 5.15674561e+00, 4.86291389e+01,
            5.63993040e+00, -6.70723117e+00, 5.37127515e+00, 4.97488909e+01,
            5.69677233e+00, -6.14825097e+00, 5.40487163e+00, 5.05800587e+01,
            5.76763132e+00, -5.72853643e+00, 6.01910405e+00, 5.19936166e+01,
            5.92466203e+00, -3.99729840e+00, 6.47786927e+00, 5.47182788e+01,
            6.03834152e+00, -3.06907888e+00, 6.24163671e+00, 5.65931017e+01,
            6.11588597e+00, -2.37464348e+00, 6.35824194e+00, 5.79425638e+01,
            6.32837376e+00, -9.50091907e-02, 6.29059014e+00, 6.19915301e+01,
            6.33498703e+00, -2.75127278e-01, 6.45947388e+00, 6.20044044e+01,
            6.42083337e+00, 6.24717152e-01, 6.26038405e+00, 6.34825210e+01,
            6.57419578e+00, 2.38321129e+00, 6.07450169e+00, 6.65206821e+01,
            6.59485151e+00, 2.25896099e+00, 6.14484674e+00, 6.69776998e+01,
            6.78359700e+00, 4.02730571e+00, 5.94580355e+00, 7.06639938e+01,
            6.82811616e+00, 4.46500400e+00, 5.59463437e+00, 7.14787593e+01,
            7.06707436e+00, 6.49816766e+00, 4.79278386e+00, 7.65057237e+01,
            7.11146031e+00, 6.55804994e+00, 4.53766783e+00, 7.71600985e+01,
            7.12515602e+00, 6.38586802e+00, 4.35623380e+00, 7.71710767e+01,
            7.17383170e+00, 6.80547009e+00, 4.52390242e+00, 7.80714071e+01,
            7.43682966e+00, 8.23254820e+00, 3.48614225e+00, 8.37925790e+01,
            7.51611894e+00, 8.57483407e+00, 2.86553082e+00, 8.56331734e+01,
            7.62155901e+00, 8.94058328e+00, 2.54342474e+00, 8.83224213e+01,
            7.69258671e+00, 8.94350685e+00, 2.61965338e+00, 9.01255460e+01,
            7.73102175e+00, 9.04441626e+00, 2.63592203e+00, 9.09827687e+01,
            7.85048102e+00, 9.17846996e+00, 1.73629965e+00, 9.37709981e+01,
            7.90297179e+00, 9.02366317e+00, 1.37709700e+00, 9.48108585e+01,
            8.15342877e+00, 8.96381312e+00, 4.00372119e-01, 1.00839312e+02,
            8.20647781e+00, 8.88872098e+00, 7.59028959e-03, 1.02083396e+02,
            8.24900789e+00, 8.49518635e+00, -1.01600060e-01, 1.03197720e+02,
            8.29655005e+00, 8.43317934e+00, -1.63820344e-01, 1.04212191e+02,
            8.44704495e+00, 7.49402086e+00, -1.00241645e+00, 1.08095799e+02,
            8.55089525e+00, 7.02738148e+00, -1.42907244e+00, 1.11050208e+02,
            8.73278992e+00, 5.97152406e+00, -2.71795094e+00, 1.15744172e+02,
            8.81539028e+00, 5.15035034e+00, -3.17292652e+00, 1.17998743e+02,
            8.96633144e+00, 4.04492667e+00, -3.60715233e+00, 1.22162762e+02,
            8.98434197e+00, 3.96526594e+00, -3.89583294e+00, 1.22567470e+02,
            9.01482794e+00, 3.85197404e+00, -3.63222503e+00, 1.23435372e+02,
            9.23456815e+00, 2.13634700e+00, -4.24237253e+00, 1.29453079e+02,
            9.34508630e+00, 9.92693454e-01, -4.40468999e+00, 1.32552698e+02,
            9.40619483e+00, 2.31693455e-01, -4.39354706e+00, 1.34116891e+02,
            9.54914293e+00, -1.37247634e+00, -4.06753891e+00, 1.38186237e+02,
            9.59471872e+00, -1.98643164e+00, -4.32130209e+00, 1.39594582e+02,
            9.70151626e+00, -3.04280752e+00, -3.97045396e+00, 1.42975996e+02,
            9.78348800e+00, -3.75304873e+00, -3.84040110e+00, 1.45563680e+02,
            9.80407372e+00, -3.88970763e+00, -3.99957862e+00, 1.46599153e+02,
            9.92157829e+00, -4.78775830e+00, -3.65809018e+00, 1.49922464e+02;

    auto [data_uniform, dt] = resample_time_series(data);

    std::cout << data_uniform << std::endl;
    std::cout << dt << std::endl;
}

int main() {
    std::default_random_engine generator;
    generator.seed(42);

    single_example();
    // resample_time_series_example();

    return 0;
}
